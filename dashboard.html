<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StudyBOT â€” Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg: radial-gradient(circle at top left, #181818, #0e0e0e);
      --card: rgba(255, 255, 255, 0.05);
      --accent: #0d6efd;
      --text: #e6eef8;
    }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Orbitron', 'Segoe UI', sans-serif;
      margin: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    .sidebar {
      width: 240px;
      background: var(--card);
      backdrop-filter: blur(10px);
      padding-top: 20px;
      transition: transform 0.3s ease;
    }
    .sidebar.hide { transform: translateX(-100%); }
    .sidebar a {
      display: block;
      color: #bbb;
      text-decoration: none;
      padding: 12px 20px;
      border-left: 3px solid transparent;
      transition: 0.3s;
    }
    .sidebar a:hover, .sidebar a.active {
      background-color: #333;
      color: #fff;
      border-left: 3px solid var(--accent);
    }
    .topbar {
      width: 100%;
      background-color: #121212;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
    }
    .main {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }
    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(126, 124, 124, 0.5);
      margin-bottom: 1.5rem;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
    <div class="d-flex justify-content-end px-3">
      <button class="btn btn-sm btn-outline-light" id="closeSidebar"><i class="bi bi-x-lg"></i></button>
    </div>
    <a href="index.html"><i class="bi bi-box-arrow-left"></i> Logout</a>
    <a href="dashboard.html" class="active"><i class="bi bi-bar-chart"></i> Dashboard</a>
    <a href="tasks.html"><i class="bi bi-check2-square"></i> Tasks</a>
    <a href="library.html"><i class="bi bi-collection"></i> Library</a>
    <a href="settings.html"><i class="bi bi-gear"></i> Settings</a>
  </nav>

  <div class="flex-grow-1 d-flex flex-column">
    <div class="topbar">
      <button class="btn btn-dark" id="openSidebar"><i class="bi bi-list"></i></button>
      <h4 class="m-0 text-light">ðŸ“Š Dashboard</h4>
    </div>

    <div class="main">
      <div class="card text-center">
        <h5>Enter Marks for Each Subject</h5>
        <div class="row g-3 mt-3">
          <div class="col-md-4"><input type="text" class="form-control" id="subject" placeholder="Subject Name"></div>
          <div class="col-md-4"><input type="number" class="form-control" id="marks" placeholder="Marks (out of 100)"></div>
          <div class="col-md-4"><button class="btn btn-primary w-100" id="addGrade">Add</button></div>
        </div>
      </div>

      <div class="card text-center">
        <h5>ðŸ“ˆ Performance Graph</h5>
        <canvas id="gradeChart" height="120"></canvas>
      </div>

      <div class="card text-center">
        <h5> Average & CGPA</h5>
        <h3 id="cgpaValue">0.00</h3>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBxprN4rO7wpNPLCQtlfflNnxt24fZqagY",
      authDomain: "study-bot-2b214.firebaseapp.com",
      databaseURL: "https://study-bot-2b214-default-rtdb.firebaseio.com",
      projectId: "study-bot-2b214",
      storageBucket: "study-bot-2b214.appspot.com",
      messagingSenderId: "2198651031",
      appId: "1:2198651031:web:f4a68ca2195568cae229d2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    const subjectInput = document.getElementById("subject");
    const marksInput = document.getElementById("marks");
    const addBtn = document.getElementById("addGrade");
    const cgpaEl = document.getElementById("cgpaValue");

    let chart;
    const ctx = document.getElementById("gradeChart").getContext("2d");

    function renderChart(data) {
      const labels = Object.keys(data);
      const marks = Object.values(data);
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{ label: "Marks", data: marks, backgroundColor: "#0d6efd" }]
        },
        options: { scales: { y: { beginAtZero: true, max: 100 } } }
      });
    }

    function calculateCGPA(data) {
      const values = Object.values(data);
      const avg = values.reduce((a,b)=>a+b,0)/values.length;
      cgpaEl.innerText = (avg/10).toFixed(2);
    }

    onAuthStateChanged(auth, user => {
      if (!user) { location.href = "index.html"; return; }
      const gradesRef = ref(db, "users/" + user.uid + "/grades");
      onValue(gradesRef, snap => {
        const data = snap.val() || {};
        if (Object.keys(data).length > 0) {
          renderChart(data);
          calculateCGPA(data);
        }
      });
      addBtn.onclick = async () => {
        if (!subjectInput.value || !marksInput.value) return;
        await set(ref(db, "users/" + user.uid + "/grades/" + subjectInput.value), Number(marksInput.value));
        subjectInput.value = "";
        marksInput.value = "";
      };
    });

    // Sidebar toggle
    const sidebar = document.getElementById("sidebar");
    document.getElementById("openSidebar").onclick = () => sidebar.classList.remove("hide");
    document.getElementById("closeSidebar").onclick = () => sidebar.classList.add("hide");
  </script>
</body>
</html>
